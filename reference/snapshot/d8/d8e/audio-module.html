<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Aurora Framework: Audio Module</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../logo.gif"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Aurora Framework
   </div>
   <div id="projectbrief">A Powerful General Purpose Framework</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('d8/d8e/audio-module.html','../../');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Audio Module </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#summary-audio">Summary</a></li>
<li class="level1"><a href="#prerequisites-audio">Prerequisites</a></li>
<li class="level1"><a href="#the-basics-audio">The basics</a></li>
<li class="level1"><a href="#starting-backend-audio">Starting the backend</a></li>
<li class="level1"><a href="#playing-debug-audio">Playing a debug stream</a></li>
<li class="level1"><a href="#playing-file-audio">Playing a audio file</a></li>
<li class="level1"><a href="#recording-audio">Recording audio</a></li>
<li class="level1"><a href="#advanced-audio">Advanced</a></li>
</ul>
</div>
<div class="textblock"><p>The Audio module contains useful methods and classes to handle audio files.</p>
<h1><a class="anchor" id="summary-audio"></a>
Summary</h1>
<p>By the end of this tutorial you'll know how to play and record audio using Aurora.</p>
<h1><a class="anchor" id="prerequisites-audio"></a>
Prerequisites</h1>
<p>This tutorial will use the three following Aurora modules:</p>
<ul>
<li>aurorafw-core</li>
<li>aurorafw-cli</li>
<li>aurorafw-audio</li>
</ul>
<h1><a class="anchor" id="the-basics-audio"></a>
The basics</h1>
<p>Firstly, we shall bootstrap our Aurora program as we did in the <a class="el" href="../../df/da8/simple-afw-app.html">previous code</a>:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../df/d93/_aurora_8h.html">AuroraFW/Aurora.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="../../d2/dc7/namespace_aurora_f_w.html">AuroraFW</a>;</div><div class="line"></div><div class="line"><span class="keyword">using namespace </span>AudioManager;</div><div class="line"></div><div class="line"><a class="code" href="../../dd/dec/struct_aurora_f_w_1_1_application.html">Application</a> *app;</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> mainAppFunction()</div><div class="line">{</div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="../../d9/db8/g72x__test_8c.html#a36ab09f980217d70eda38d4c59d6eb2d">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div><div class="line">{</div><div class="line">    app = <span class="keyword">new</span> <a class="code" href="../../dd/dec/struct_aurora_f_w_1_1_application.html">Application</a>(mainAppFunction, argc, argv);</div><div class="line"></div><div class="line">    <span class="keyword">delete</span> app;</div><div class="line">    <span class="keywordflow">return</span> EXIT_SUCCESS;</div><div class="line">}</div></div><!-- fragment --><p>(Of course, the name of vars/methods/classes doesn't need to be exactly the same as written in the tutorials)</p>
<p>(<em>Notice how we declare the usage on the AudioManager namespace. It improves the readibility of the tutorial.</em>)</p>
<p>From here on out, all the code is written in the <code>mainAppFunction()</code> (so we can use Aurora).</p>
<h1><a class="anchor" id="starting-backend-audio"></a>
Starting the backend</h1>
<p>Before our application has audio capabilities, we must initialize the AudioBackend. Add these two lines of code to the main method:</p>
<div class="fragment"><div class="line">AudioBackend::start();</div><div class="line"><a class="code" href="../../dd/d96/_init_8c.html#ae5a773506a43a9bc54bce503f234c209">AudioBackend::terminate</a>();</div></div><!-- fragment --><p>If you enabled debug mode (<code>--afw-debug</code>), you will already see some output, like this:</p>
<div class="fragment"><div class="line">[DEBUG] AudioBackend initialized. Num. of available audio devices: 16 (16 output devices, 4 input devices.)</div><div class="line">[DEBUG] AudioBackend was terminated.</div></div><!-- fragment --><p>I already added in the <code><a class="el" href="../../dd/d96/_init_8c.html#ae5a773506a43a9bc54bce503f234c209">terminate()</a></code> method so I don't forget later. Now we will output some audio.</p>
<dl class="section warning"><dt>Warning</dt><dd>Do not forget to call <code><a class="el" href="../../dd/d96/_init_8c.html#ae5a773506a43a9bc54bce503f234c209">terminate()</a></code> on the backend on the end of the application, so <em>Aurora</em> and <em>PortAudio</em> can deallocate it's pointers.</dd></dl>
<h1><a class="anchor" id="playing-debug-audio"></a>
Playing a debug stream</h1>
<p>The following code must be written between the previous <code>start()</code> and <code><a class="el" href="../../dd/d96/_init_8c.html#ae5a773506a43a9bc54bce503f234c209">terminate()</a></code> calls.</p>
<p>Even if you don't have any audio files, you can create a debug AudioOStream by leaving it's constructor empty:</p>
<div class="fragment"><div class="line">AudioOStream debugStream;</div></div><!-- fragment --><p>After that just play it:</p>
<div class="fragment"><div class="line">debugStream.play();</div></div><!-- fragment --><p>The audio playback will be executed on another thread, so we need to wait some time on the main loop. For that we use PortAudio's <code>Pa_Sleep()</code> method:</p>
<div class="fragment"><div class="line">Pa_Sleep(3000);     <span class="comment">// 3000 miliseconds = 3 seconds</span></div></div><!-- fragment --><p>After we're done, we stop the stream:</p>
<div class="fragment"><div class="line">debugStream.stop();</div></div><!-- fragment --><p>Your code should now look like this:</p>
<div class="fragment"><div class="line">AudioBackend::start();</div><div class="line"></div><div class="line">AudioOStream debugStream;</div><div class="line">debugStream.play();</div><div class="line"></div><div class="line">Pa_Sleep(3000);     <span class="comment">// 3000 miliseconds = 3 seconds</span></div><div class="line">debugStream.stop();</div><div class="line"></div><div class="line">AudioBackend::stop();</div></div><!-- fragment --><p>Run it and congratulations! You made your application output some audio!</p>
<dl class="section warning"><dt>Warning</dt><dd>Be careful, the debug wave sound is quite <b>loud and annoying</b>. Lower your volume before running the example.</dd></dl>
<h1><a class="anchor" id="playing-file-audio"></a>
Playing a audio file</h1>
<p>OK, you want audio capabilities to play files, and not some debug and noisy waves. We'll do just that in a minute.</p>
<p>If you don't have a compatible sound file (Aurora can't play .MP3 files yet), grab the <code>aurora-example.ogg</code> file <a href="https://raw.githubusercontent.com/aurora-fw/app_tests_audio/master/rsrc/example.ogg">here</a>.</p>
<p>Now, create an AudioOStream as before, but now, give it the file path:</p>
<div class="fragment"><div class="line">AudioOStream audioStream(<span class="stringliteral">&quot;aurora-example.ogg&quot;</span>);</div></div><!-- fragment --><p>Now play it like before:</p>
<div class="fragment"><div class="line">audioStream.play();</div></div><!-- fragment --><p>Before you run your code though, we need to change something: the debug stream had no end, but normal audio files have. In order to account that, let's make a simple empty loop that only stops when the audio stops:</p>
<div class="fragment"><div class="line"><span class="keywordflow">while</span>(audioStream.isPlaying()) {}</div></div><!-- fragment --><p>After that we don't even need to <code>stop()</code> the song now! The code now should look as follow:</p>
<div class="fragment"><div class="line">AudioBackend::start();</div><div class="line"></div><div class="line">AudioOStream audioStream;</div><div class="line">audioStream.play();</div><div class="line"></div><div class="line"><span class="keywordflow">while</span>(audioStream.isPlaying()) {}</div><div class="line"></div><div class="line">AudioBackend::stop();</div></div><!-- fragment --><p>Enjoy your little music player!</p>
<dl class="section note"><dt>Note</dt><dd>The path given to the audio stream is relative to where the program is being executed.</dd></dl>
<h1><a class="anchor" id="recording-audio"></a>
Recording audio</h1>
<p>To record the audio, you must first create an AudioInfo structure:</p>
<div class="fragment"><div class="line">AudioInfo info;</div></div><!-- fragment --><p>Then you give it data. There's lot of things you can specify, but these 3 are always needed:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define SAMPLERATE 44100</span></div><div class="line">...</div><div class="line"></div><div class="line">info.setSampleRate(SAMPLERATE);</div><div class="line">info.setChannels(2);</div><div class="line">info.setFormat(SF_FORMAT_OGG | SF_FORMAT_VORBIS);</div></div><!-- fragment --><ul>
<li>The <code>setSampleRate()</code> defines the sample rate of the audio file. (it's generally <em>44.1KHz</em>)</li>
<li>The <code>setChannels()</code> defines how many channels should the file have. (1 is mono, 2 is stereo, etc...)</li>
<li>The <code>setFormat()</code> defines the format to save to. For more info, see AudioInfo's <code>setFormat()</code> documentation.</li>
</ul>
<p>After we define the info, we open a new AudioIStream:</p>
<div class="fragment"><div class="line">AudioIStream inputStream(<span class="stringliteral">&quot;recording.ogg&quot;</span>, &amp;info, SAMPLERATE * 3); <span class="comment">// 3 seconds of audio to record.</span></div></div><!-- fragment --><p>With this we allocated a buffer to hold our recording. Now we simply record:</p>
<div class="fragment"><div class="line">inputStream.record();</div><div class="line"><span class="keywordflow">while</span>(inputStream.isRecording) {}</div></div><!-- fragment --><p>The recording stops when you specifically stop it or when the buffer gets full. Now we just save it into disk:</p>
<div class="fragment"><div class="line">inputStream.save();</div></div><!-- fragment --><p>The code should now look as follow:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define SAMPLERATE 44100</span></div><div class="line">...</div><div class="line"></div><div class="line">AudioBackend::start();</div><div class="line"></div><div class="line">AudioInfo info;</div><div class="line"></div><div class="line">info.setSampleRate(SAMPLERATE);</div><div class="line">info.setChannels(2);</div><div class="line">info.setFormat(SF_FORMAT_OGG | SF_FORMAT_VORBIS);</div><div class="line"></div><div class="line">AudioIStream inputStream(<span class="stringliteral">&quot;recording.ogg&quot;</span>, &amp;info, SAMPLERATE * 3); <span class="comment">// 3 seconds of audio to record.</span></div><div class="line"></div><div class="line">inputStream.record();</div><div class="line"><span class="keywordflow">while</span>(inputStream.isRecording) {}</div><div class="line"></div><div class="line">inputStream.save();</div><div class="line"></div><div class="line">AudioBackend::stop();</div></div><!-- fragment --><p>Run it and make any noise for 3 seconds. After that, it's saved onto the disk!</p>
<h1><a class="anchor" id="advanced-audio"></a>
Advanced</h1>
<p>You probably don't want to just play audio. You might want to add reverb, make it 3D, set up looping, etc...</p>
<p>All the already implemented features are used in the <em>app-tests-audio</em>. Check it <a href="https://github.com/aurora-fw/app_tests_audio/blob/master/src/main.cpp">here</a>. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
